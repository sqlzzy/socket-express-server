<!DOCTYPE html>
<html>
  <head>
    <title>Player</title>
  </head>
  <body>
    <h1>Player</h1>
    <label for="id-room">ID room:</label>
    <input type="text" id="id-room" size="42" maxlength="36" disabled>
    <button id="copy-id-room-btn">Copy ID room</button>
    <br>
    <br>
    Players:
    <div id="player-list"></div>
    <br>
    <br>
    <button style="display: none;" id="endRound">End round!</button>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const inputIdRoom = document.querySelector('#id-room');
      const btnCopyIdRoom = document.querySelector('#copy-id-room-btn');
      const joinRoomForm = document.getElementById('joinRoomForm');
      const roomIdInput = document.getElementById('roomId');
      const namePlayerInput = document.getElementById('namePlayer');
      const status = document.getElementById('status');
      const roomID = location.hash.split('#')[1];
      const endRoundBtn = document.getElementById('endRound');
      let currentUrl = document.location.href;
      const urlParams = new URLSearchParams(window.location.search);
      const idRoom = urlParams.get('room');
      const idPlayer = urlParams.get('player');
      const dataPlayer = {idRoom, idPlayer, currentUrl};
      let playersList;

      inputIdRoom.value = idRoom;

      socket.emit('stayInRoom', dataPlayer);

      socket.on('playerList', (players) => {
        playersList = players;
        const playerList = document.getElementById('player-list');
        playerList.innerHTML = '';
        players.forEach((player) => {
          const hostPlayer = player.host === 1 ? 'Host' : '';

          const playerDiv = document.createElement('div');
          playerDiv.innerText = `${player.namePlayer} ${hostPlayer}`;
          playerDiv.id = player.idPlayer;
          
          playerList.appendChild(playerDiv);
        });
      });

      endRoundBtn.addEventListener('click', () => {
        socket.emit('endRound', dataPlayer.idRoom);
      });

      btnCopyIdRoom.addEventListener('click', () => {
        event.preventDefault();
        navigator.clipboard.writeText(inputIdRoom.value);
      });

      socket.on('redirect', (url) => {
        document.location.href = url;
      });

      socket.on('becomeHost', () => {
        endRoundBtn.style.display = "block";
      });

      socket.on('endBecomeHost', () => {
        endRoundBtn.style.display = "none";
      });
    </script>
  </body>
</html>
