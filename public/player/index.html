<!DOCTYPE html>
<html>
  <head>
    <title>Player</title>
  </head>
  <body>
    <h1 id="title-page">Player</h1>
    <label for="link-room">Link room:</label>
    <input type="text" id="link-room" size="42" maxlength="36" disabled>
    <button id="copy-link-room-btn">Copy link room</button>
    <br>
    <br>
    Players:
    <div id="player-list"></div>
    <br>
    <br>
    <button style="display: none;" id="endRound">End round!</button>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const inputLinkRoom = document.querySelector('#link-room');
      const btnCopyLinkRoom = document.querySelector('#copy-link-room-btn');
      const joinRoomForm = document.getElementById('joinRoomForm');
      const namePlayerInput = document.getElementById('namePlayer');
      const status = document.getElementById('status');
      const endRoundBtn = document.getElementById('endRound');
      const titlePage = document.querySelector('#title-page');
      let currentUrl = document.location.href;
      const currentLocation = location.origin;
      const urlParams = new URLSearchParams(window.location.search);
      const idRoom = urlParams.get('room');
      const idPlayer = urlParams.get('player');
      const dataPlayer = {idRoom, idPlayer, currentUrl};
      let playersList;

      inputLinkRoom.value = `${currentLocation}/lobby/?room=${idRoom}`;

      socket.emit('stayInRoom', dataPlayer);

      socket.on('getPlayerName', (namePlayer) => {
        document.title = `Player ${namePlayer}`;
        titlePage.textContent = `Player ${namePlayer}`;
      });

      socket.on('playerList', (players) => {
        playersList = players;
        const playerList = document.getElementById('player-list');
        playerList.innerHTML = '';
        players.forEach((player) => {
          const hostPlayer = player.host === 1 ? 'Host' : '';

          const playerDiv = document.createElement('div');
          playerDiv.innerText = `${player.namePlayer} ${hostPlayer}`;
          playerDiv.id = player.idPlayer;
          
          playerList.appendChild(playerDiv);
        });
      });

      endRoundBtn.addEventListener('click', () => {
        socket.emit('endRound', dataPlayer.idRoom);
      });

      btnCopyLinkRoom.addEventListener('click', () => {
        event.preventDefault();
        navigator.clipboard.writeText(inputLinkRoom.value);
      });

      socket.on('redirect', (url) => {
        document.location.href = url;
      });

      socket.on('becomeHost', () => {
        endRoundBtn.style.display = "block";
      });

      socket.on('endBecomeHost', () => {
        endRoundBtn.style.display = "none";
      });
    </script>
  </body>
</html>
